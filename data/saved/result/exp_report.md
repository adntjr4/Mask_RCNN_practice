## 실험

1. test
2. 
3. pre, post 도입, 
4. rpn_bbox_regression 'sum'
5. regression loss weight 0.1
6. regression xy max를 0.5로 늘림.
7. fpn training
8. resnet anchor 32~512, topk (12000, 2000)
9. bbox regression w,h 비율을 log(2)->log(4)로 늘림.
10. log(2)로 줄이고 xy도 0.3으로 내림
11. subtract mean
12. freeze 2 front layer, post top k 1000
13. warmup 1 epoch
14. xy unlimit

---

## 12 번 실험 (24 epoch) proposal variable 바꾸고 실험

### nms 0.5, score_thres 0.7, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.300 |
|  AP  | 0.50      |  all   |  100  | 0.624 |
|  AP  | 0.75      |  all   |  100  | 0.250 |
|  AP  | 0.50:0.95 | small  |  100  | 0.201 |
|  AP  | 0.50:0.95 | medium |  100  | 0.463 |
|  AP  | 0.50:0.95 | large  |  100  | 0.324 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.349 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.383 |
|  AR  | 0.50:0.95 | small  |  100  | 0.237 |
|  AR  | 0.50:0.95 | medium |  100  | 0.515 |
|  AR  | 0.50:0.95 | large  |  100  | 0.435 |

### nms 0.4, score_thres 0.7, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.299 |
|  AP  | 0.50      |  all   |  100  | 0.628 |
|  AP  | 0.75      |  all   |  100  | 0.249 |
|  AP  | 0.50:0.95 | small  |  100  | 0.199 |
|  AP  | 0.50:0.95 | medium |  100  | 0.458 |
|  AP  | 0.50:0.95 | large  |  100  | 0.320 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.345 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.373 |
|  AR  | 0.50:0.95 | small  |  100  | 0.231 |
|  AR  | 0.50:0.95 | medium |  100  | 0.506 |
|  AR  | 0.50:0.95 | large  |  100  | 0.418 |

### nms 0.6, score_thres 0.7, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.297 |
|  AP  | 0.50      |  all   |  100  | 0.607 |
|  AP  | 0.75      |  all   |  100  | 0.249 |
|  AP  | 0.50:0.95 | small  |  100  | 0.206 |
|  AP  | 0.50:0.95 | medium |  100  | 0.465 |
|  AP  | 0.50:0.95 | large  |  100  | 0.322 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.351 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.395 |
|  AR  | 0.50:0.95 | small  |  100  | 0.245 |
|  AR  | 0.50:0.95 | medium |  100  | 0.525 |
|  AR  | 0.50:0.95 | large  |  100  | 0.452 |

### nms 0.5, score_thres 0.8, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.293 |
|  AP  | 0.50      |  all   |  100  | 0.604 |
|  AP  | 0.75      |  all   |  100  | 0.247 |
|  AP  | 0.50:0.95 | small  |  100  | 0.192 |
|  AP  | 0.50:0.95 | medium |  100  | 0.454 |
|  AP  | 0.50:0.95 | large  |  100  | 0.319 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.116 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.340 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.370 |
|  AR  | 0.50:0.95 | small  |  100  | 0.221 |
|  AR  | 0.50:0.95 | medium |  100  | 0.503 |
|  AR  | 0.50:0.95 | large  |  100  | 0.425 |

### nms 0.5, score_thres 0.6, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.305 |
|  AP  | 0.50      |  all   |  100  | 0.636 |
|  AP  | 0.75      |  all   |  100  | 0.250 |
|  AP  | 0.50:0.95 | small  |  100  | 0.210 |
|  AP  | 0.50:0.95 | medium |  100  | 0.467 |
|  AP  | 0.50:0.95 | large  |  100  | 0.326 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.355 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.392 |
|  AR  | 0.50:0.95 | small  |  100  | 0.248 |
|  AR  | 0.50:0.95 | medium |  100  | 0.522 |
|  AR  | 0.50:0.95 | large  |  100  | 0.441 |

### nms 0.5, score_thres 0.5, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.308 |
|  AP  | 0.50      |  all   |  100  | 0.647 |
|  AP  | 0.75      |  all   |  100  | 0.254 |
|  AP  | 0.50:0.95 | small  |  100  | 0.214 |
|  AP  | 0.50:0.95 | medium |  100  | 0.471 |
|  AP  | 0.50:0.95 | large  |  100  | 0.328 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.359 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.400 |
|  AR  | 0.50:0.95 | small  |  100  | 0.258 |
|  AR  | 0.50:0.95 | medium |  100  | 0.529 |
|  AR  | 0.50:0.95 | large  |  100  | 0.447 |

### nms 0.5, score_thres 0.4, xy_limit 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.311 |
|  AP  | 0.50      |  all   |  100  | 0.657 |
|  AP  | 0.75      |  all   |  100  | 0.254 |
|  AP  | 0.50:0.95 | small  |  100  | 0.218 |
|  AP  | 0.50:0.95 | medium |  100  | 0.474 |
|  AP  | 0.50:0.95 | large  |  100  | 0.329 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.119 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.363 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.407 |
|  AR  | 0.50:0.95 | small  |  100  | 0.268 |
|  AR  | 0.50:0.95 | medium |  100  | 0.535 |
|  AR  | 0.50:0.95 | large  |  100  | 0.451 |


---
## 12

- 학습을 시키고 regression limit를 풀었더니 AP가 더 올리감.
- limit를 주지 않고 안정적으로 학습하는 것을 확인해봐야겠음
- limit 실험은 xy가 AP에 더 영향을 줌.

### epoch 24
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.291 |
|  AP  | 0.50      |  all   |  100  | 0.610 |
|  AP  | 0.75      |  all   |  100  | 0.236 |
|  AP  | 0.50:0.95 | small  |  100  | 0.199 |
|  AP  | 0.50:0.95 | medium |  100  | 0.454 |
|  AP  | 0.50:0.95 | large  |  100  | 0.318 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.115 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.345 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.380 |
|  AR  | 0.50:0.95 | small  |  100  | 0.233 |
|  AR  | 0.50:0.95 | medium |  100  | 0.508 |
|  AR  | 0.50:0.95 | large  |  100  | 0.436 |

### epoch 24 (bbox regression unlimit)
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.303 |
|  AP  | 0.50      |  all   |  100  | 0.628 |
|  AP  | 0.75      |  all   |  100  | 0.253 |
|  AP  | 0.50:0.95 | small  |  100  | 0.208 |
|  AP  | 0.50:0.95 | medium |  100  | 0.464 |
|  AP  | 0.50:0.95 | large  |  100  | 0.324 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.353 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.386 |
|  AR  | 0.50:0.95 | small  |  100  | 0.244 |
|  AR  | 0.50:0.95 | medium |  100  | 0.515 |
|  AR  | 0.50:0.95 | large  |  100  | 0.435 |

### epoch 24 (only x,y limit)
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.289 |
|  AP  | 0.50      |  all   |  100  | 0.601 |
|  AP  | 0.75      |  all   |  100  | 0.235 |
|  AP  | 0.50:0.95 | small  |  100  | 0.196 |
|  AP  | 0.50:0.95 | medium |  100  | 0.448 |
|  AP  | 0.50:0.95 | large  |  100  | 0.316 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.116 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.344 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.382 |
|  AR  | 0.50:0.95 | small  |  100  | 0.240 |
|  AR  | 0.50:0.95 | medium |  100  | 0.508 |
|  AR  | 0.50:0.95 | large  |  100  | 0.434 |

### epoch 24 (only w,h limit)
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.300 |
|  AP  | 0.50      |  all   |  100  | 0.624 |
|  AP  | 0.75      |  all   |  100  | 0.250 |
|  AP  | 0.50:0.95 | small  |  100  | 0.201 |
|  AP  | 0.50:0.95 | medium |  100  | 0.462 |
|  AP  | 0.50:0.95 | large  |  100  | 0.324 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.118 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.349 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.383 |
|  AR  | 0.50:0.95 | small  |  100  | 0.237 |
|  AR  | 0.50:0.95 | medium |  100  | 0.514 |
|  AR  | 0.50:0.95 | large  |  100  | 0.435 |

---
## 10

- epoch 3

proposal IOU = 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.155 |
|  AP  | 0.50      |  all   |  100  | 0.434 |
|  AP  | 0.75      |  all   |  100  | 0.065 |
|  AP  | 0.50:0.95 | small  |  100  | 0.089 |
|  AP  | 0.50:0.95 | medium |  100  | 0.265 |
|  AP  | 0.50:0.95 | large  |  100  | 0.140 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.071 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.215 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.233 |
|  AR  | 0.50:0.95 | small  |  100  | 0.103 |
|  AR  | 0.50:0.95 | medium |  100  | 0.346 |
|  AR  | 0.50:0.95 | large  |  100  | 0.285 |

---
## 9

- epoch 12
- 큰 이미지들은 학습이 잘 안되는 듯하여 비율을 늘림.
- 전반적으로 떨어짐

proposal IOU = 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.217 |
|  AP  | 0.50      |  all   |  100  | 0.512 |
|  AP  | 0.75      |  all   |  100  | 0.146 |
|  AP  | 0.50:0.95 | small  |  100  | 0.158 |
|  AP  | 0.50:0.95 | medium |  100  | 0.375 |
|  AP  | 0.50:0.95 | large  |  100  | 0.262 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.101 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.301 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.334 |
|  AR  | 0.50:0.95 | small  |  100  | 0.190 |
|  AR  | 0.50:0.95 | medium |  100  | 0.442 |
|  AR  | 0.50:0.95 | large  |  100  | 0.415 |

---
## 8

- epoch 12
- 결과 사진을 보면 중간 사이즈 object들은 잘 잡아내지만, 큰 오브젝트들을 잘 못잡아냄 (512 anchor도 만들었지만)
- proposal IOU가 없으면 AP가 떨어짐, 실제로 detectron에도 마지막에 IOU threshold는 0.5임
- bbox regression 제한 때문에 큰 것들을 못 잡는 건 아닌지 생각됨.

proposal IOU = 0.3
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.271 |
|  AP  | 0.50      |  all   |  100  | 0.599 |
|  AP  | 0.75      |  all   |  100  | 0.215 |
|  AP  | 0.50:0.95 | small  |  100  | 0.194 |
|  AP  | 0.50:0.95 | medium |  100  | 0.425 |
|  AP  | 0.50:0.95 | large  |  100  | 0.278 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.111 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.331 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.354 |
|  AR  | 0.50:0.95 | small  |  100  | 0.224 |
|  AR  | 0.50:0.95 | medium |  100  | 0.471 |
|  AR  | 0.50:0.95 | large  |  100  | 0.400 |

proposal IOU = 0.5
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.267 |
|  AP  | 0.50      |  all   |  100  | 0.587 |
|  AP  | 0.75      |  all   |  100  | 0.208 |
|  AP  | 0.50:0.95 | small  |  100  | 0.201 |
|  AP  | 0.50:0.95 | medium |  100  | 0.437 |
|  AP  | 0.50:0.95 | large  |  100  | 0.277 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.111 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.339 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.376 |
|  AR  | 0.50:0.95 | small  |  100  | 0.235 |
|  AR  | 0.50:0.95 | medium |  100  | 0.494 |
|  AR  | 0.50:0.95 | large  |  100  | 0.436 |

proposal IOU = 1.0
| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.197 |
|  AP  | 0.50      |  all   |  100  | 0.395 |
|  AP  | 0.75      |  all   |  100  | 0.176 |
|  AP  | 0.50:0.95 | small  |  100  | 0.207 |
|  AP  | 0.50:0.95 | medium |  100  | 0.420 |
|  AP  | 0.50:0.95 | large  |  100  | 0.208 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.111 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.327 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.435 |
|  AR  | 0.50:0.95 | small  |  100  | 0.264 |
|  AR  | 0.50:0.95 | medium |  100  | 0.553 |
|  AR  | 0.50:0.95 | large  |  100  | 0.542 |
---

---
## 7

망함

---
## 6

- regression에 제한은 원래 코드에 없음.
- xy 제한을 0.3에서 0.5로 늘려봄
- 더 좋은 성능이 나오면 제한을 detectron으로 늘려봄.
- 성능은 낮게 나오나 제한을 아예 없애보고 실험 해봄.

| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.217 |
|  AP  | 0.50      |  all   |  100  | 0.547 |
|  AP  | 0.75      |  all   |  100  | 0.128 |
|  AP  | 0.50:0.95 | small  |  100  | 0.141 |
|  AP  | 0.50:0.95 | medium |  100  | 0.347 |
|  AP  | 0.50:0.95 | large  |  100  | 0.225 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.095 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.283 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.310 |
|  AR  | 0.50:0.95 | small  |  100  | 0.182 |
|  AR  | 0.50:0.95 | medium |  100  | 0.414 |
|  AR  | 0.50:0.95 | large  |  100  | 0.369 |

---
## 5

- 4번 실험에서 cls confidense가 매우 낮았음.
- regression loss가 너무 커서 인듯 한데, 기존의 방법은 cls 개수만큼 나눠준 것처럼 human detection은 loss 크기를 비슷하게 맞춰주기 위해 0.1을 곱함.

| 종류 |    IoU    |  area  |maxDets| value |
|:----:|:---------:|:------:|:-----:|:-----:|
|  AP  | 0.50:0.95 |  all   |  100  | 0.224 |
|  AP  | 0.50      |  all   |  100  | 0.544 |
|  AP  | 0.75      |  all   |  100  | 0.147 |
|  AP  | 0.50:0.95 | small  |  100  | 0.153 |
|  AP  | 0.50:0.95 | medium |  100  | 0.358 |
|  AP  | 0.50:0.95 | large  |  100  | 0.224 |
|  AR  | 0.50:0.95 |  all   |   1   | 0.093 |
|  AR  | 0.50:0.95 |  all   |   10  | 0.279 |
|  AR  | 0.50:0.95 |  all   |  100  | 0.303 |
|  AR  | 0.50:0.95 | small  |  100  | 0.188 |
|  AR  | 0.50:0.95 | medium |  100  | 0.413 |
|  AR  | 0.50:0.95 | large  |  100  | 0.335 |

---
## 4

- 코드를 보니 bbox regression은 sum하여 normalize함.
- sum하여 실행함.
- 기존 bbox regression delta에 0.1곱하는 것은 뺌.

